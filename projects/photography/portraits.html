<!-- Written for teo by ChatGPT4 --> 
<!DOCTYPE html>
<html>
<head>
    <title>Image Gallery</title>
    <style>
        .image-container {
            margin: 20px;
        }
		.image-container img {
			max-width: 100%;
			max-height: 100vh; /* Limit the height to the height of the viewport */
			object-fit: contain; /* Ensures the aspect ratio of the image is preserved */
		}
    </style>
</head>
<body>
    <div id="gallery"></div>

    <script>
        function createObserver() {
            let observer;
            let options = {
                root: null,
                rootMargin: "0px",
                threshold: 0.1
            };
            observer = new IntersectionObserver(handleIntersect, options);
            document.querySelectorAll('.lazy').forEach(img => observer.observe(img));
        }

        function handleIntersect(entries, observer) {
            entries.forEach(entry => {
                if (entry.intersectionRatio > 0) {
                    loadImage(entry.target);
                    observer.unobserve(entry.target);
                }
            });
        }

        function loadImage(image) {
            image.src = image.dataset.src;
        }

        fetch('portraits.txt')
            .then(response => response.text())
            .then(data => {
                const lines = data.split('\n');
                const galleryDiv = document.getElementById('gallery');

                lines.forEach(line => {
                    const parts = line.split(':');
                    if (parts.length === 2) {
                        const filename = parts[0].trim();
                        const caption = parts[1].trim();

                        const imageContainer = document.createElement('div');
                        imageContainer.className = 'image-container';

                        const img = document.createElement('img');
                        img.dataset.src = filename;
                        img.className = 'lazy';
                        img.alt = caption;

                        const captionDiv = document.createElement('div');
                        captionDiv.textContent = caption;

                        imageContainer.appendChild(img);
                        imageContainer.appendChild(captionDiv);
                        galleryDiv.appendChild(imageContainer);
                    }
                });
                
                createObserver();
            });
    </script>
</body>
</html>

