<!DOCTYPE html>
<html>

	<head>
	<title>Wishlist</title>
	<link href="../stylesheets/teostyle.css" rel="stylesheet" type="text/css" media="all">

	<style>
    body {
        margin-left: auto;
        margin-right: auto;
        margin-top: 90px;
        margin-bottom: 50px;
        width: 700px;
		font-family: 'iA Writer Quattro S', serif !important;
		font-size: 16px;
		line-height: 1.4;
	} 

	h1 {
		margin-bottom: 0;
	}

	hr {
		margin-top: 0;
	}

	.section {
		margin-bottom: 100px;
	}

	.section h2 {
		margin-bottom: 20px;
		font-size: 20px;
	}

	/* Masonry layout for books */
	.books-masonry {
		position: relative;
		width: 100%;
	}

	.book-item {
		position: absolute;
		cursor: pointer;
		padding: 10px 0;
		margin: -10px 0;
		width: calc(33.333% - 13.333px);
	}

	.book-cover {
		width: 100%;
		height: auto;
		border-radius: 4px;
		box-shadow: 0 2px 8px rgba(0,0,0,0.1);
		transition: transform 0.2s ease, box-shadow 0.2s ease;
		display: block;
	}

	.book-item:hover .book-cover {
		transform: translateY(-4px);
		box-shadow: 0 4px 16px rgba(0,0,0,0.2);
	}

	.book-tooltip {
		position: fixed;
		background: rgba(0,0,0,0.9);
		color: white;
		padding: 8px 12px;
		border-radius: 4px;
		font-size: 14px;
		white-space: normal;
		opacity: 0;
		pointer-events: none;
		transition: opacity 0.2s ease;
		z-index: 10000;
		max-width: 300px;
		min-width: 200px;
		text-align: center;
		line-height: 1.3;
		word-wrap: break-word;
		overflow-wrap: break-word;
	}

	@media (hover: hover) {
		.book-item:hover .book-tooltip {
			opacity: 1;
		}
	}
	
	.book-tooltip.js-controlled {
		opacity: 0 !important;
	}
	
	.book-tooltip.js-controlled.show {
		opacity: 1 !important;
	}

	.placeholder-text {
		color: #666;
		font-style: italic;
		text-align: center;
		padding: 40px;
	}

	/* Book overlay */
	.book-overlay {
		position: fixed;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background: rgba(0,0,0,0.8);
		display: flex;
		align-items: center;
		justify-content: center;
		z-index: 10000;
		opacity: 0;
		visibility: hidden;
		transition: opacity 0.3s ease, visibility 0.3s ease;
	}

	.book-overlay.show {
		opacity: 1;
		visibility: visible;
	}

	.book-overlay-content {
		background: white;
		border-radius: 8px;
		max-width: 500px;
		width: 90%;
		max-height: 80vh;
		overflow-y: auto;
		position: relative;
		box-shadow: 0 10px 30px rgba(0,0,0,0.3);
	}

	.book-overlay-header {
		padding: 20px 20px 10px;
		border-bottom: 1px solid #eee;
		position: relative;
	}

	.book-overlay-close {
		position: absolute;
		top: 15px;
		right: 15px;
		background: none;
		border: none;
		font-size: 24px;
		cursor: pointer;
		color: #666;
		width: 32px;
		height: 32px;
		display: flex;
		align-items: center;
		justify-content: center;
		border-radius: 4px;
	}

	.book-overlay-close:hover {
		background: #f5f5f5;
		color: #333;
	}

	.book-overlay-title {
		font-size: 20px;
		font-weight: bold;
		margin: 0 0 5px 0;
		line-height: 1.3;
		padding-right: 40px;
	}

	.book-overlay-author {
		color: #666;
		margin: 0;
		font-style: italic;
	}

	.book-overlay-body {
		padding: 20px;
	}

	.book-overlay-note {
		margin: 0 0 15px 0;
		line-height: 1.5;
		color: #333;
	}

	.book-overlay-link {
		display: inline-flex;
		align-items: center;
		gap: 8px;
		color: #0066cc;
		text-decoration: none;
		font-size: 14px;
		padding: 8px 12px;
		border: 1px solid #0066cc;
		border-radius: 4px;
		transition: background-color 0.2s ease, color 0.2s ease;
	}

	.book-overlay-link:hover {
		background-color: #0066cc;
		color: white;
	}

	.book-overlay-link svg {
		width: 16px;
		height: 16px;
		fill: currentColor;
	}

	@media (max-width: 768px) {
		body {
			width: 90%;
			margin-top: 40px;
		}
		
		.book-item {
			width: calc(50% - 10px);
		}
	}

	@media (max-width: 480px) {
		.book-item {
			width: 100%;
		}
	}

	</style>
	</head>

	<body>
	<h1>Wishlist</h1>
	<hr>
	
	<div class="section">
		<h2>Books</h2>
		<div> Ideally the edition i wish for is the one of the cover shown.<br>
			If possible and not too inconvenient i would prefer books from shops in the following order:<br>
			<b>Brick & Mortar</b><br>
			Books and Company, Fantask (sci-fi only), other independent book stores<br>
			Politikens Boghandel/Arnold Busch<br>
			<b>Online</b><br>
			<a href="https://bookbot.com">Bookbot</a>, <a href="https://medimops.de">Medimops</a>, <a href="https://www.kennys.ie">Kenny's Bookshop</a>, <a href="https://abebooks.com">Abe books</a><br>

		</div>
		<br>
		<div id="books-container" class="books-masonry">
			<div class="placeholder-text">Loading books...</div>
		</div>
	</div>

	<div class="section">
		<h2>Clothes</h2>
		<div id="clothes-container" class="books-masonry">
			<p class="placeholder-text">Nice jumpers from Gran Sasso.</p>
		</div>
	</div>

	<div class="section">
		<h2>Toys</h2>
		<div id="toys-container" class="books-masonry">
			<p class="placeholder-text">nothing to see...</p>
		</div>
	</div>

	<div class="section">
		<h2>Other</h2>
		<div id="other-container" class="books-masonry">
			<p class="placeholder-text">Nothing here yet.</p>
		</div>
	</div>

    <div class="footer">
        <a href="/index.html" class="home-button">
            <img src="/home.png" alt="Home" />
        </a>
    </div>

	<script>
	async function loadCategory(category, containerId, dataFile) {
		try {
			const response = await fetch(dataFile);
			const text = await response.text();

			if (!text.trim()) {
				// Keep existing placeholder text if file is empty
				return;
			}

			const lines = text.trim().split('\n').filter(line => line.trim());
			const container = document.getElementById(containerId);

			if (lines.length === 0) {
				// Keep existing placeholder text if no valid lines
				return;
			}

			container.innerHTML = '';

			lines.forEach(line => {
				// Skip commented out lines (starting with //)
				if (line.trim().startsWith('//')) {
					return;
				}
				const item = parseLine(line);
				if (item) {
					const itemElement = createItemElement(item);
					container.appendChild(itemElement);
				}
			});

			// Initial layout after all items are added
			setTimeout(masonryLayout, 50);
		} catch (error) {
			// Keep existing placeholder text if file doesn't exist or error occurs
			console.log(`No ${category} data file found (${dataFile}) - keeping placeholder text`);
		}
	}

	async function loadBooks() {
		await loadCategory('books', 'books-container', 'books.txt');
	}

	async function loadClothes() {
		await loadCategory('clothes', 'clothes-container', 'clothes.txt');
	}

	async function loadToys() {
		await loadCategory('toys', 'toys-container', 'toys.txt');
	}

	async function loadOther() {
		await loadCategory('other items', 'other-container', 'other.txt');
	}

	function parseLine(line) {
		const parts = [];
		let current = '';
		let escaped = false;
		let inQuotes = false;
		
		for (let i = 0; i < line.length; i++) {
			const char = line[i];
			
			if (escaped) {
				current += char;
				escaped = false;
			} else if (char === '\\') {
				escaped = true;
			} else if (char === '"') {
				inQuotes = !inQuotes;
			} else if (char === ':' && !inQuotes) {
				parts.push(current);
				current = '';
			} else {
				current += char;
			}
		}
		
		if (current || parts.length > 0) {
			parts.push(current);
		}
		
		if (parts.length < 3) {
			console.warn('Invalid line format:', line);
			return null;
		}
		
		return {
			author: parts[0].trim(),
			title: parts[1].trim(),
			image: parts[2].trim(),
			url: parts.length > 3 && parts[3].trim() ? parts[3].trim() : null,
			note: parts.length > 4 && parts[4].trim() ? parts[4].trim() : null
		};
	}


	function masonryLayout() {
		// Layout all masonry containers
		const containers = document.querySelectorAll('.books-masonry');

		containers.forEach(container => {
			const items = container.querySelectorAll('.book-item');

			if (items.length === 0) return;

			// Get number of columns based on screen size
			const containerWidth = container.offsetWidth;
			let columns = 3;
			if (containerWidth <= 768) columns = 2;
			if (containerWidth <= 480) columns = 1;

			const gap = 20;
			const itemWidth = (containerWidth - (gap * (columns - 1))) / columns;

			// Initialize column heights
			const columnHeights = new Array(columns).fill(0);

			// Position each item
			items.forEach((item, index) => {
				// Find the shortest column
				const shortestColumn = columnHeights.indexOf(Math.min(...columnHeights));

				// Calculate position
				const x = shortestColumn * (itemWidth + gap);
				const y = columnHeights[shortestColumn];

				// Set item position and width
				item.style.left = x + 'px';
				item.style.top = y + 'px';
				item.style.width = itemWidth + 'px';

				// Update column height
				columnHeights[shortestColumn] += item.offsetHeight + gap;
			});

			// Set container height
			const maxHeight = Math.max(...columnHeights);
			container.style.height = maxHeight + 'px';
		});
	}

	function createItemElement(item) {
		const itemDiv = document.createElement('div');
		itemDiv.className = 'book-item';

		const img = document.createElement('img');
		img.src = `images/${item.image}`;
		img.alt = `${item.title} by ${item.author}`;
		img.className = 'book-cover';

		img.onerror = function() {
			this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDEyMCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMjAiIGhlaWdodD0iMTgwIiBmaWxsPSIjZjBmMGYwIiBzdHJva2U9IiNjY2MiLz4KPHRleHQgeD0iNjAiIHk9IjkwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSI+Tm8gSW1hZ2U8L3RleHQ+Cjwvc3ZnPg==';
		};

		// Wait for image to load before calculating layout
		img.onload = function() {
			setTimeout(masonryLayout, 10);
		};

		const tooltip = document.createElement('div');
		tooltip.className = 'book-tooltip';
		tooltip.innerHTML = `${item.author}<br><strong>${item.title}</strong>`;

		// Position tooltip on hover
		function updateTooltipPosition() {
			const rect = itemDiv.getBoundingClientRect();

			// Estimate tooltip width based on text content
			// Average character width in 14px font is about 8px, plus padding
			const textContent = item.title + ' by ' + item.author;
			const estimatedWidth = Math.min(Math.max(textContent.length * 7 + 24, 200), 300);

			// Calculate horizontal position (centered on item, accounting for tooltip width)
			let left = rect.left + rect.width / 2 - estimatedWidth / 2;

			// Ensure tooltip doesn't go off screen
			const viewportWidth = window.innerWidth;

			// Adjust if too far left
			if (left < 10) {
				left = 10;
			}
			// Adjust if too far right
			else if (left + estimatedWidth > viewportWidth - 10) {
				left = viewportWidth - estimatedWidth - 10;
			}

			tooltip.style.left = left + 'px';
			tooltip.style.top = (rect.bottom + 10) + 'px';
		}

		let scrollHandler = null;
		let scrollTimeout = null;

		if (!isTouchDevice) {
			// On desktop, use normal hover behavior
			itemDiv.addEventListener('mouseenter', (e) => {
				updateTooltipPosition();

				// Follow smoothly on scroll
				scrollHandler = () => {
					updateTooltipPosition();
				};
				window.addEventListener('scroll', scrollHandler, { passive: true });
			});

			itemDiv.addEventListener('mouseleave', (e) => {
				// Remove scroll listener
				if (scrollHandler) {
					window.removeEventListener('scroll', scrollHandler);
					scrollHandler = null;
				}
			});
		}

		itemDiv.appendChild(img);
		itemDiv.appendChild(tooltip);

		// Add click handler for overlay (always, regardless of URL)
		itemDiv.addEventListener('click', (e) => {
			e.preventDefault();
			showItemOverlay(item);
		});
		itemDiv.style.cursor = 'pointer';

		return itemDiv;
	}

	// Detect touch devices
	const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
	
	// Create overlay element
	const overlay = document.createElement('div');
	overlay.className = 'book-overlay';
	overlay.innerHTML = `
		<div class="book-overlay-content">
			<div class="book-overlay-header">
				<h3 class="book-overlay-title"></h3>
				<p class="book-overlay-author"></p>
				<button class="book-overlay-close" aria-label="Close">&times;</button>
			</div>
			<div class="book-overlay-body">
				<p class="book-overlay-note"></p>
				<a class="book-overlay-link" href="#" target="_blank" style="display: none;">
					<svg viewBox="0 0 24 24">
						<path d="M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z"/>
					</svg>
					Visit Store
				</a>
			</div>
		</div>
	`;
	document.body.appendChild(overlay);
	
	// Show item overlay
	function showItemOverlay(item) {
		const title = overlay.querySelector('.book-overlay-title');
		const author = overlay.querySelector('.book-overlay-author');
		const note = overlay.querySelector('.book-overlay-note');
		const link = overlay.querySelector('.book-overlay-link');

		title.textContent = item.title;
		author.textContent = item.author;

		if (item.note) {
			note.textContent = item.note;
			note.style.display = 'block';
		} else {
			note.style.display = 'none';
		}

		if (item.url && item.url.trim()) {
			link.href = item.url;
			link.style.display = 'inline-flex';
		} else {
			link.style.display = 'none';
		}

		overlay.classList.add('show');
		document.body.style.overflow = 'hidden'; // Prevent background scrolling
	}

	// Hide item overlay
	function hideItemOverlay() {
		overlay.classList.remove('show');
		document.body.style.overflow = ''; // Restore scrolling
	}
	
	// Close overlay on background click
	overlay.addEventListener('click', (e) => {
		if (e.target === overlay) {
			hideItemOverlay();
		}
	});

	// Close overlay on X button click
	overlay.querySelector('.book-overlay-close').addEventListener('click', hideItemOverlay);

	// Close overlay on Escape key
	document.addEventListener('keydown', (e) => {
		if (e.key === 'Escape' && overlay.classList.contains('show')) {
			hideItemOverlay();
		}
	});
	

	// Load all categories when page loads
	document.addEventListener('DOMContentLoaded', () => {
		loadBooks();
		loadClothes();
		loadToys();
		loadOther();
	});
	
	// Recalculate layout on window resize
	window.addEventListener('resize', () => {
		setTimeout(masonryLayout, 100);
	});
	</script>

	</body>

</html>
